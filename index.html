<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" />
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <script src="dist/index.bundle.js"></script>
    
    <title>Twister</title>

    <style>
      body {
        font-family: 'Ubuntu Mono', monospace;
      }
    </style>
    <style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <script>;(function () {'use strict';
      const times = n => new Array(n).fill();

      if (typeof Twister === 'undefined') {
        throw new Error('Twister not available, build assets and try again');
      }

      //
      // cube
      //
      const drawCube = () => {
        const svg = document.querySelector('#cube-svg');
        svg.innerHTML = '';

        const colors = ['#FFEE5D', '#EFAA18', '#2589E2', '#EC6157', '#5CBD60', '#F0F0F0'];
        const getColMap = n => times(n ** 2).map((x, i) => i % n);
        const getRowMap = n => times(n ** 2).map((x, i) => Math.floor(i / n));
        const faceTransforms = { u: [1, 0], l: [0, 1], f: [1, 1], r: [2, 1], b: [3, 1], d: [1, 2] };

        const colMap = getColMap(cube.options.size);
        const rowMap = getRowMap(cube.options.size);
        const stickerSize = 1 / cube.options.size;
        const stickerStroke = 1 / cube.options.size ** 3;

        Object.entries(cube.state).forEach(([face, stickers]) => {
          const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
          g.setAttribute('transform', `translate(${faceTransforms[face][0]}, ${faceTransforms[face][1]})`);

          stickers.forEach((sticker, index) => {
            const col = colMap[index];
            const row = rowMap[index];
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('fill', colors[sticker.value]);
            rect.setAttribute('height', stickerSize);
            rect.setAttribute('stroke-width', stickerStroke);
            rect.setAttribute('stroke', '#1a202c');
            rect.setAttribute('width', stickerSize);
            rect.setAttribute('x', stickerSize * col);
            rect.setAttribute('y', stickerSize * row);
            rect.setAttribute('rx', stickerSize / 4);
            g.appendChild(rect);
          });
          
          svg.appendChild(g);
        });
      }

      const cube = new Twister.Cube({
        size: 3,
      });

      const reset = cube.reset.bind(cube);
  
      const turn = cube.turn.bind(cube);

      const redraw = () => {
        drawCube();
        document.querySelector('#cube-options').textContent = JSON.stringify(cube.options, null, 2);
      }

      cube.options = new Proxy(cube.options, {
        set(obj, prop, value) {
          obj[prop] = value;
          reset();
          redraw();
        },
      }); 

      cube.scramble = (...args) => {
        const scramble = cube.generateScramble(...args);
        cube.turn(scramble);
        document.querySelector('#cube-scramble').textContent = scramble;
        return scramble;
      }

      cube.turn = (...args) => {
        const result = turn(...args);
        redraw();
        return result;
      }

      cube.reset = () => {
        reset();
        redraw();
        document.querySelector('#cube-scramble').textContent = 'None';
      }

      document.addEventListener('DOMContentLoaded', redraw);

      window.cube = cube;
    })();</script>
  </head>
  <body class="bg-gray-900 text-gray-300">
    <div class="container mx-auto p-6" x-data="{ puzzle: 'cube' }">
      <div class="flex flex-wrap justify-between mb-8">
        <h1 class="font-bold leading-none mb-4 text-2xl sm:text-4xl">
          <a class="hover:underline hover:text-white" href="https://github.com/scottbedard/twister">
            @bedard/twister
          </a>
        </h1>
        <a
          aria-label="View source on GitHub"
          class="github-corner"
          href="https://github.com/scottbedard/twister">
          <svg
            aria-hidden="true"
            class="absolute border-none text-gray-100 top-0 right-0"
            height="80"
            style="fill: #4A5568"
            viewBox="0 0 250 250"
            width="80">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
          </svg>
        </a>
      </div>
      
      <h2 x-text="puzzle" class="font-bold mb-3 text-2xl"></h2>

      <!-- cube -->
      <div x-show="puzzle === 'cube'">
        <div x-data="{ alg: '', parsedTurn: null, scramble: '' }" class="flex flex-wrap">
          <div class="pb-6 w-full md:pb-0 md:pr-8 md:w-1/2">
            <div class="grid gap-2 sm:grid-cols-3">
              <form @submit.prevent="scramble = cube.turn(alg)">
                <input
                  x-model="alg"
                  class="appearance-none border border-transparent bg-gray-700 h-10 px-4 rounded w-full hover:border-gray-600"
                  placeholder="enter turns" />
              </form>
              <button
                @click="scramble = cube.scramble()"
                class="appearance-none bg-gray-800 h-10 px-4 rounded w-full sm:w-auto hover:bg-gray-700">
                scramble
              </button>
              <button
                @click="scramble = cube.reset()"
                class="appearance-none bg-gray-800 h-10 px-4 rounded w-full sm:w-auto hover:bg-gray-700">
                reset
              </button>
            </div>
            <div class="pt-6">
              <p class="leading-loose mb-6">
                This cube is exposed globally as <a class="bg-gray-800 px-2 py-1 rounded whitespace-pre hover:bg-gray-700 hover:text-white" href="javascript:console.log(window.cube)">window.cube</a>.
                Use your dev tools or the inputs above to manipulate it. For example, <a class="bg-gray-800 px-2 py-1 rounded whitespace-pre hover:bg-gray-700 hover:text-white" href="javascript:cube.options.size = Math.max((cube.options.size + 1) % 11, 2);">cube.options.size = x</a> resizes the cube.
              </p>
              <div class="font-bold">Options:</div>
              <div id="cube-options" class="mb-6 whitespace-pre"></div>
              <div class="font-bold">Scramble:</div>
              <div
                class="overflow-y-auto select-all"
                id="cube-scramble"
                style="max-height: 200px"
                x-text="scramble || 'None'"></div>
            </div>
          </div>
          <div class="w-full md:pl-8 md:w-1/2">
            <svg
              id="cube-svg"
              viewBox="0 0 4 3"
              xmlns="http://www.w3.org/2000/svg">
            </svg>
          </div>
        </div>
      </div>

      <!-- dodecaminx -->
      <div x-show="puzzle === 'dodecaminx'">
        Model not implemented
      </div>
    </div>
  </body>
</html>
