<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" />
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <script src="dist/index.bundle.js"></script>
    
    <title>Twister</title>

    <style>
      body {
        font-family: 'Ubuntu Mono', monospace;
      }
    </style>

    <script>;(function () {'use strict';
      const times = n => new Array(n).fill();

      if (typeof Twister === 'undefined') {
        throw new Error('Twister not available, build assets and try again');
      }

      //
      // cube
      //
      const drawCube = () => {
        const svg = document.querySelector('#cube-svg');
        svg.innerHTML = '';

        const colors = ['yellow', 'orange', 'blue', 'red', 'green', '#c9c9c9'];
        const getColMap = n => times(n ** 2).map((x, i) => i % n);
        const getRowMap = n => times(n ** 2).map((x, i) => Math.floor(i / n));
        const faceTransforms = { u: [1, 0], l: [0, 1], f: [1, 1], r: [2, 1], b: [3, 1], d: [1, 2] };

        const colMap = getColMap(cube.options.size);
        const rowMap = getRowMap(cube.options.size);
        const stickerSize = 1 / cube.options.size;
        const stickerStroke = 1 / cube.options.size ** 3;

        Object.entries(cube.state).forEach(([face, stickers]) => {
          const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
          g.setAttribute('transform', `translate(${faceTransforms[face][0]}, ${faceTransforms[face][1]})`);

          stickers.forEach((sticker, index) => {
            const col = colMap[index];
            const row = rowMap[index];
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('fill', colors[sticker.value]);
            rect.setAttribute('height', stickerSize);
            rect.setAttribute('stroke-width', stickerStroke);
            rect.setAttribute('stroke', 'white');
            rect.setAttribute('width', stickerSize);
            rect.setAttribute('x', stickerSize * col);
            rect.setAttribute('y', stickerSize * row);
            g.appendChild(rect);
          });
          
          svg.appendChild(g);
        });
      }

      const cube = new Twister.Cube({
        size: 3,
      });

      const reset = cube.reset.bind(cube);
  
      const turn = cube.turn.bind(cube);

      const redraw = () => {
        drawCube();
        document.querySelector('#cube-options').textContent = JSON.stringify(cube.options, null, 2);
      }

      cube.options = new Proxy(cube.options, {
        set(obj, prop, value) {
          obj[prop] = value;
          reset();
          redraw();
        },
      }); 

      cube.scramble = (...args) => {
        const scramble = cube.generateScramble(...args);
        cube.turn(scramble);
        document.querySelector('#cube-scramble').textContent = scramble;
        return scramble;
      }

      cube.turn = (...args) => {
        const result = turn(...args);
        redraw();
        return result;
      }

      cube.reset = () => {
        reset();
        redraw();
        document.querySelector('#cube-scramble').textContent = 'None';
      }

      document.addEventListener('DOMContentLoaded', redraw);

      window.cube = cube;
    })();</script>
  </head>
  <body>
    <div class="container mx-auto p-6" x-data="{ puzzle: 'cube' }">
      <div class="flex flex-wrap justify-between mb-6">
        <h1 class="font-bold leading-none mb-2 text-2xl sm:text-4xl">
          <a class="hover:underline" href="https://github.com/scottbedard/twister">@bedard/twister</a>
        </h1>
        <select
          class="appearance-none block cursor-pointer border border-gray-400 h-10 text-gray-700 px-4 rounded w-full sm:w-auto"
          x-model="puzzle">
          <option value="cube">Cube</option>
          <option value="dodecaminx">Dodecaminx</option>
        </select>
      </div>
      
      <h2 x-text="puzzle" class="font-bold mb-3 text-2xl"></h2>

      <!-- cube -->
      <div x-show="puzzle === 'cube'">
        <div x-data="{ alg: '', parsedTurn: null, scramble: '' }" class="flex flex-wrap">
          <div class="pb-6 w-full md:pb-0 md:pr-3 md:w-1/2">
            <div class="grid gap-2 sm:grid-cols-3">
              <form @submit.prevent="scramble = cube.turn(alg)">
                <input
                  x-model="alg"
                  class="appearance-none border border-gray-400 h-10 px-4 rounded w-full hover:border-gray-500"
                  placeholder="enter turns" />
              </form>
              <button
                @click="scramble = cube.scramble()"
                class="appearance-none bg-gray-200 h-10 px-4 rounded w-full sm:w-auto hover:bg-gray-300">
                scramble
              </button>
              <button
                @click="scramble = cube.reset()"
                class="appearance-none bg-gray-200 h-10 px-4 rounded w-full sm:w-auto hover:bg-gray-300">
                reset
              </button>
            </div>
            <div class="pt-6">
              <p class="leading-loose mb-6">
                The puzzle is exposed globally as <a class="bg-gray-200 p-1 hover:bg-gray-300" href="javascript:console.log(window.cube)">window.cube</a>.
                You can resize the puzzle by executing <a class="bg-gray-200 p-1 hover:bg-gray-300" href="javascript:cube.options.size = Math.max((cube.options.size + 1) % 11, 2);">cube.options.size = x</a>.
              </p>
              <div class="font-bold">Options:</div>
              <div id="cube-options" class="mb-6 whitespace-pre"></div>
              <div class="font-bold">Scramble:</div>
              <div
                class="overflow-y-auto"
                id="cube-scramble"
                style="max-height: 200px"
                x-text="scramble || 'None'"></div>
            </div>
          </div>
          <svg
            class="w-full md:pl-3 md:w-1/2"
            id="cube-svg"
            viewBox="0 0 4 3"
            xmlns="http://www.w3.org/2000/svg">
          </svg>
        </div>
      </div>

      <!-- dodecaminx -->
      <div x-show="puzzle === 'dodecaminx'">
        Model not implemented
      </div>
    </div>
  </body>
</html>
