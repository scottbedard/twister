"use strict";function t(t,e){return Math.floor(Math.random()*(e-t+1))+t}function e(t,e){return o(t,e).shift()}function r(t,e){return new Array(t).fill(e)}function n(e){return e[t(0,e.length-1)]}function s(t){return o(t).reverse()}function o(t,e,r){return t.slice(e,r)}function i(t,e,r,...n){return t.splice(e,r,...n)}function c(t){return f(a(t))}function a(t){const e=Math.sqrt(t.length);return r(e).map((r,n)=>{const s=n*e;return o(t,s,s+e)})}function u(t,e){return r(e).map((e,r)=>({data:null,originalIndex:r,value:t}))}function h(t){const e=t[0].value;for(let r=1;r<t.length;r++)if(t[r].value!==e)return!1;return!0}function l(t){return p(f(t))}function p(t){return t.reduce((t,e)=>t.concat(e),[])}function f(t){return t[0].map((e,r)=>t.map(t=>t[r]))}function D(t,e){const{depth:r,wide:n}=t;for(let t=r,s=n?0:r-1;t>s;t--)e(t,-t,t-1)}function B(t,e){return-1===e?p(s(c(t))):2===e?s(t):l(s(a(t)))}function L(t){return{U:{r:a(t.U),c:c(t.U)},L:{r:a(t.L),c:c(t.L)},F:{r:a(t.F),c:c(t.F)},R:{r:a(t.R),c:c(t.R)},B:{r:a(t.B),c:c(t.B)},D:{r:a(t.D),c:c(t.D)}}}function R(t){return t}function F(t){return t.trim()}Object.defineProperty(exports,"__esModule",{value:!0});class U{constructor(t){this.options=t,this.reset()}scramble(t){this.reset(),this.turn(this.generateScramble(t))}turn(t){t.split(" ").map(F).filter(R).map(t=>this.parseTurn(t)).forEach(t=>this.applyTurn(t))}}function d(t,e,r=null){if(!Number.isInteger(t)||t<5)throw new Error("Polygon sides must be an integer 5 or greater");if(!Number.isInteger(e)||e<2)throw new Error("Polygon layers must be an integer 5 or greater");const n=[];let s=0;for(let o=0,i=Math.ceil(e/2);o<i;o++){const i=(e-2*o-1)*t;for(let t=0;t<i;t++)n.push({originalIndex:s,depth:o+1,value:r}),s++}if(e%2){const t=Math.floor(e/2)+1;n.push({originalIndex:s,depth:t,value:r})}return{layers:e,sides:t,stickers:n}}exports.Cube=class extends U{constructor(t){if(!Number.isInteger(t.size))throw new Error("Cube size must be an integer");if(t.size<2)throw new Error("Cube size must be two or greater");super(t)}applyTurn(t){const{target:r}=t;if("X"===r)this.state=function({U:t,L:e,F:r,R:n,B:i,D:c},{rotation:a}){return-1===a?{U:s(i),L:B(e,1),F:o(t),R:B(n,-1),B:s(c),D:o(r)}:2===a?{U:o(c),L:B(e,2),F:s(i),R:B(n,2),B:s(r),D:o(t)}:{U:o(r),L:B(e,-1),F:o(c),R:B(n,1),B:s(t),D:s(i)}}(this.state,t);else if("Y"===r)this.state=function({U:t,L:e,F:r,R:n,B:s,D:i},{rotation:c}){return-1===c?{U:B(t,-1),L:o(s),F:o(e),R:o(r),B:o(n),D:B(i,1)}:2===c?{U:B(t,2),L:o(n),F:o(s),R:o(e),B:o(r),D:B(i,2)}:{U:B(t,1),L:o(r),F:o(n),R:o(s),B:o(e),D:B(i,-1)}}(this.state,t);else if("Z"===r)this.state=function({U:t,L:e,F:r,R:n,B:o,D:i},{rotation:c}){return-1===c?{U:B(n,-1),L:B(t,-1),F:B(r,-1),R:B(i,-1),B:B(o,1),D:B(e,-1)}:2===c?{U:s(i),L:s(n),F:B(r,2),R:s(e),B:B(o,2),D:s(t)}:{U:B(e,1),L:B(i,1),F:B(r,1),R:B(t,1),B:B(o,-1),D:B(n,1)}}(this.state,t);else{const r=function(t){const{target:e}=t;switch(e){case"U":return"U";case"L":return"L";case"F":return"F";case"R":return"R";case"B":return"B";case"D":return"D"}}(t);if((1===t.depth||t.wide)&&(this.state[r]=B(this.state[r],t.rotation)),t.depth>=this.options.size){let e=2;1!==t.rotation&&-1!==t.rotation||(e=-1*t.rotation);const r=function(t){const{target:e}=t;switch(e){case"U":return"D";case"L":return"R";case"F":return"B";case"R":return"L";case"B":return"F";case"D":return"U"}}(t);this.state[r]=B(this.state[r],e)}switch(r){case"U":!function(t,r){const n=L(t);D(r,(s,o,c)=>{const a=e(n.B.r,c),u=e(n.R.r,c),h=e(n.F.r,c),l=e(n.L.r,c);let f,D,B,L;2===r.rotation?(f=h,D=l,B=a,L=u):-1===r.rotation?(f=u,D=h,B=l,L=a):(f=l,D=a,B=u,L=h),i(n.B.r,c,1,f),i(n.R.r,c,1,D),i(n.F.r,c,1,B),i(n.L.r,c,1,L),t.B=p(n.B.r),t.R=p(n.R.r),t.F=p(n.F.r),t.L=p(n.L.r)})}(this.state,t);break;case"L":!function(t,r){const n=L(t);D(r,(o,c,a)=>{const u=e(n.U.c,a),h=e(n.F.c,a),p=e(n.D.c,a),f=e(n.B.c,c);let D,B,L,R;2===r.rotation?(D=p,B=s(f),L=u,R=s(h)):-1===r.rotation?(D=h,B=p,L=s(f),R=s(u)):(D=s(f),B=u,L=h,R=s(p)),i(n.U.c,a,1,D),i(n.F.c,a,1,B),i(n.D.c,a,1,L),i(n.B.c,c,1,R),t.U=l(n.U.c),t.F=l(n.F.c),t.D=l(n.D.c),t.B=l(n.B.c)})}(this.state,t);break;case"F":!function(t,r){const n=L(t);D(r,(o,c,a)=>{const u=e(n.U.r,c),h=e(n.R.c,a),f=e(n.D.r,a),D=e(n.L.c,c);let B,L,R,F;2===r.rotation?(B=s(f),L=s(D),R=s(u),F=s(h)):-1===r.rotation?(B=h,L=s(f),R=D,F=s(u)):(B=s(D),L=u,R=s(h),F=f),i(n.U.r,c,1,B),i(n.R.c,a,1,L),i(n.D.r,a,1,R),i(n.L.c,c,1,F),t.U=p(n.U.r),t.R=l(n.R.c),t.D=p(n.D.r),t.L=l(n.L.c)})}(this.state,t);break;case"R":!function(t,r){const n=L(t);D(r,(o,c,a)=>{const u=e(n.U.c,c),h=e(n.B.c,a),p=e(n.D.c,c),f=e(n.F.c,c);let D,B,L,R;2===r.rotation?(D=p,B=s(f),L=u,R=s(h)):-1===r.rotation?(D=s(h),B=s(p),L=f,R=u):(D=f,B=s(u),L=s(h),R=p),i(n.U.c,c,1,D),i(n.B.c,a,1,B),i(n.D.c,c,1,L),i(n.F.c,c,1,R),t.U=l(n.U.c),t.B=l(n.B.c),t.D=l(n.D.c),t.F=l(n.F.c)})}(this.state,t);break;case"B":!function(t,r){const n=L(t);D(r,(o,c,a)=>{const u=e(n.U.r,a),h=e(n.L.c,a),f=e(n.D.r,c),D=e(n.R.c,c);let B,L,R,F;2===r.rotation?(B=s(f),L=s(D),R=s(u),F=s(h)):-1===r.rotation?(B=s(h),L=f,R=s(D),F=u):(B=D,L=s(u),R=h,F=s(f)),i(n.U.r,o-1,1,B),i(n.L.c,o-1,1,L),i(n.D.r,c,1,R),i(n.R.c,c,1,F),t.U=p(n.U.r),t.L=l(n.L.c),t.D=p(n.D.r),t.R=l(n.R.c)})}(this.state,t);break;case"D":!function(t,r){const n=L(t);D(r,(s,o)=>{const c=e(n.F.r,o),a=e(n.R.r,o),u=e(n.B.r,o),h=e(n.L.r,o);let l,f,D,B;2===r.rotation?(l=u,f=h,D=c,B=a):-1===r.rotation?(l=a,f=u,D=h,B=c):(l=h,f=c,D=a,B=u),i(n.F.r,o,1,l),i(n.R.r,o,1,f),i(n.B.r,o,1,D),i(n.L.r,o,1,B),t.F=p(n.F.r),t.R=p(n.R.r),t.B=p(n.B.r),t.L=p(n.L.r)})}(this.state,t)}}}generateScramble(e=Math.max(20,Math.pow(this.options.size,3))){const r=["U","L","F","R","B","D"],s=Math.floor(this.options.size/2),o=[],i={U:["L","F","R","B"],L:["U","F","D","B"],F:["L","U","R","D"],R:["U","B","D","F"],B:["U","L","D","R"],D:["F","R","B","L"]};for(let t=0,s=n(r);t<e;t++)s=n(i[s]),o.push(s);return o.map(e=>function(t){let e="";(t.depth>1&&!t.wide||t.depth>2)&&(e=t.depth);let r=t.wide?"w":"",n="";return-1===t.rotation?n="-":2===t.rotation&&(n=2),`${e}${t.target.toUpperCase()}${r}${n}`}({depth:this.options.size>3?t(0,s):1,rotation:n([-1,1,2]),target:e,wide:this.options.size>3&&!!t(0,1)})).join(" ")}isSolved(){return h(this.state.U)&&h(this.state.L)&&h(this.state.F)&&h(this.state.R)&&h(this.state.B)&&h(this.state.D)}parseTurn(t){return function(t){const e=t.match(/^(\d)*([ulfrbdxyzULFRBDXYZ]){1}(w)*(['-2])*$/);if(null===e)throw new Error(`Invalid turn: ${t}`);const r=e[4],n=e[2],s=Boolean(e[3]);let o=e[1]?parseInt(e[1],10):1;s&&(o=Math.max(2,o));let i=1;return"-"===r||"'"===r?i=-1:"2"===r&&(i=2),{depth:o,rotation:i,target:n,wide:s}}(t)}reset(){const t=Math.pow(this.options.size,2);this.state={U:u(0,t),L:u(1,t),F:u(2,t),R:u(3,t),B:u(4,t),D:u(5,t)}}},exports.Dodecaminx=class extends U{constructor(t){if(!Number.isInteger(t.size))throw new Error("Dodecaminx size must be an integer");if(t.size<2)throw new Error("Dodecaminx size must be two or greater");super(t)}applyTurn(t){}generateScramble(t){return""}isSolved(){return!1}parseTurn(t){return{depth:1,rotation:1,target:"F",wide:!1}}reset(){this.state={U:d(5,this.options.size,0),F:d(5,this.options.size,1),L:d(5,this.options.size,2),R:d(5,this.options.size,3),BL:d(5,this.options.size,4),BR:d(5,this.options.size,5),DL:d(5,this.options.size,6),DR:d(5,this.options.size,7),DBL:d(5,this.options.size,8),DBR:d(5,this.options.size,9),B:d(5,this.options.size,10),D:d(5,this.options.size,11)}}};
